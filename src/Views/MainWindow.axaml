<Window
    xmlns="https://github.com/avaloniaui"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:vm="clr-namespace:DekibaeCsvAnalyzer.ViewModels"
    x:Class="DekibaeCsvAnalyzer.Views.MainWindow"
    x:DataType="vm:MainWindowViewModel"
    x:CompileBindings="False"
    Width="1000" Height="700"
    Title="Dekibae CSV Analyzer">
  <Grid RowDefinitions="Auto,*,Auto" ColumnDefinitions="*">
    <!-- Header -->
    <Border Background="Transparent" Padding="12">
      <StackPanel Orientation="Vertical" Spacing="4">
        <TextBlock Text="Dekibae CSV Analyzer" FontSize="20"/>
        <TextBlock Text="Scanner, filters, analysis, exports" Opacity="0.7"/>
      </StackPanel>
    </Border>

    <!-- Body -->
    <ScrollViewer Grid.Row="1">
      <StackPanel Margin="12" Spacing="12">
        <!-- Paths -->
        <TextBlock Text="Paths" FontWeight="Bold"/>
        <Grid ColumnDefinitions="Auto,*,Auto" RowDefinitions="Auto,Auto,Auto">
          <TextBlock Text="Input Root" Margin="0,0,8,0" VerticalAlignment="Center"/>
          <TextBox Grid.Column="1" Text="{Binding InputRoot}" MinWidth="600"/>
          <Button Grid.Column="2" x:Name="BrowseInputButton" Content="Browse..." Margin="8,0,0,0"/>

          <TextBlock Grid.Row="1" Text="Output Root" Margin="0,8,8,0" VerticalAlignment="Center"/>
          <TextBox Grid.Row="1" Grid.Column="1" Text="{Binding OutputRoot}" MinWidth="600"/>
          <Button Grid.Row="1" Grid.Column="2" x:Name="OpenOutputButton" Content="Open" Margin="8,8,0,0"/>

          <TextBlock Grid.Row="2" Text="Codebook Path:" Margin="0,8,8,0" VerticalAlignment="Center"/>
          <TextBox Grid.Row="2" Grid.Column="1" Text="{Binding CodebookPath}" MinWidth="600"/>
          <Button Grid.Row="2" Grid.Column="2" x:Name="BrowseCodebookButton" Content="Browse..." Margin="8,8,0,0"/>
        </Grid>

        <!-- Filters -->
        <TextBlock Text="Filters" FontWeight="Bold"/>
        <Grid ColumnDefinitions="Auto,*,Auto,*,Auto,*" RowDefinitions="Auto,Auto">
          <TextBlock Text="IC:" Margin="0,0,8,0" VerticalAlignment="Center"/>
          <TextBox Grid.Column="1" Text="{Binding IC}"/>
          <TextBlock Grid.Column="2" Text="LotNo:" Margin="16,0,8,0" VerticalAlignment="Center"/>
          <TextBox Grid.Column="3" Text="{Binding LotNo}"/>
          <TextBlock Grid.Column="4" Text="Date:" Margin="16,0,8,0" VerticalAlignment="Center"/>
          <DatePicker Grid.Column="5" SelectedDate="{Binding Date}"/>

          <TextBlock Grid.Row="1" Text="Date Range" Margin="0,8,8,0" VerticalAlignment="Center"/>
          <CheckBox Grid.Row="1" Grid.Column="1" IsChecked="{Binding UseDateRange}" Content="Use"/>
          <TextBlock Grid.Row="1" Grid.Column="2" Text="From:" Margin="16,8,8,0" VerticalAlignment="Center"/>
          <DatePicker Grid.Row="1" Grid.Column="3" SelectedDate="{Binding DateFrom}"/>
          <TextBlock Grid.Row="1" Grid.Column="4" Text="To:" Margin="16,8,8,0" VerticalAlignment="Center"/>
          <DatePicker Grid.Row="1" Grid.Column="5" SelectedDate="{Binding DateTo}"/>
        </Grid>

        <!-- Parameters -->
        <TextBlock Text="Parameters" FontWeight="Bold"/>
        <Grid ColumnDefinitions="Auto,*,Auto,*,Auto,*" RowDefinitions="Auto">
          <TextBlock Text="Cluster Radius:" VerticalAlignment="Center"/>
          <TextBox Grid.Column="1" Text="{Binding ClusterRadius}"/>
          <TextBlock Grid.Column="2" Text="Cluster Window [sec]:" Margin="16,0,0,0" VerticalAlignment="Center"/>
          <TextBox Grid.Column="3" Text="{Binding ClusterTimeWindowSec}"/>
          <TextBlock Grid.Column="4" Text="Alarm Window [sec]:" Margin="16,0,0,0" VerticalAlignment="Center"/>
          <TextBox Grid.Column="5" Text="{Binding AlarmWindowSec}"/>
        </Grid>
        <Grid ColumnDefinitions="Auto,*" RowDefinitions="Auto" Margin="0,8,0,0">
          <TextBlock Text="Alarm Threshold:" VerticalAlignment="Center"/>
          <TextBox Grid.Column="1" Text="{Binding AlarmThreshold}"/>
        </Grid>

        <!-- Actions & Progress -->
        <StackPanel Orientation="Horizontal" Spacing="8">
          <Button Content="Run" Command="{Binding RunCommand}" IsEnabled="{Binding IsNotRunning}"/>
          <Button Content="Cancel" Command="{Binding CancelCommand}" IsEnabled="{Binding IsRunning}"/>
          <Button Content="Open Logs" x:Name="OpenLogsButton"/>
          <Button Content="Save Settings" Command="{Binding SaveSettingsCommand}"/>
        </StackPanel>

        <ProgressBar IsIndeterminate="{Binding IsRunning}" Height="6"/>
        <TextBlock Text="{Binding StatusText}"/>

        <!-- Results -->
        <TextBlock Text="Results" FontWeight="Bold"/>
        <ItemsControl ItemsSource="{Binding RecentOutputs}">
          <ItemsControl.ItemTemplate>
            <DataTemplate>
              <StackPanel Orientation="Horizontal" Spacing="8">
                <TextBlock Text="{Binding}" Width="700" TextTrimming="CharacterEllipsis"/>
                <Button Content="Open"
                        Command="{Binding DataContext.OpenPathCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                        CommandParameter="{Binding .}"/>
              </StackPanel>
            </DataTemplate>
          </ItemsControl.ItemTemplate>
        </ItemsControl>
      </StackPanel>
    </ScrollViewer>

    <!-- Footer -->
    <Border Grid.Row="2" Padding="12" Background="Transparent">
      <TextBlock Text=".NET 8 / Avalonia 11" Opacity="0.6"/>
    </Border>
  </Grid>
</Window>

